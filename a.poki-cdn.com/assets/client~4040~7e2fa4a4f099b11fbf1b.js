try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="13291268-c7e9-4e78-9f2c-a97458b71bd1",e._sentryDebugIdIdentifier="sentry-dbid-13291268-c7e9-4e78-9f2c-a97458b71bd1")}catch(e){}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"e2666c180fa7bebc5f13e10d529fc7733e085335"};(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[4040],{74275:(e,t,n)=>{function o(e,t){return e.ratings.userVotes[t]||0}function i(e,t){return e.ratings.previousUserVotes[t]||0}function r(e,t){const{userVotes:n,feedbackGiven:o}=e.ratings;return 0!==n[t]&&void 0!==o[t]&&!o[t]}function a(e){return e.ratings.voteEpicInitilized}function l(e){return e.ratings.ratingsData}n.d(t,{BK:()=>a,U1:()=>i,p5:()=>o,xI:()=>l,z5:()=>r})},4834:(e,t,n)=>{function o(){const e=document.getElementById("game-element");try{var t;null==e||null===(t=e.contentWindow)||void 0===t||null===(t=t.frames[0])||void 0===t||t.focus()}catch{try{var n;null==e||null===(n=e.contentWindow)||void 0===n||n.focus()}catch{null==e||e.focus()}}}n.d(t,{r:()=>o})},24040:(e,t,n)=>{n.r(t),n.d(t,{cloudSaveGameScriptErrorEpic:()=>H,fetchSaveGameEpic:()=>K,fixIOSFullscreen:()=>Q,fullscreenEpic:()=>Z,gameLoadingFinishedEpic:()=>q,generateScreenshotEpic:()=>ee,pubHostInitializedEpic:()=>N,receiveScreenshotEpic:()=>ne,sendBugReportEpic:()=>te,setRecentGameEpic:()=>J,showCSPWarningEpic:()=>oe,trackRecentGameEpic:()=>Y,updatePokiURLParams:()=>A});var o=n(59099),i=n(8767),r=n(63720),a=n(61701),l=n(62467),c=n(16126),d=n(9336),s=n(76981),u=n(56978),p=n(44240),g=n(67791),f=n(38975),v=n(81160),m=n(39697),y=n(83349),w=n(29079),h=n(42891),E=n(48554),b=n(46493),_=n(91323),S=n(90385),I=n(13150),D=n(4834),x=n(25302),k=n(23260),G=n(58606),F=n(53210),R=n(25733),O=n(6788),P=n(71219),L=n(56469),T=n(74275),B=n(86494),C=n(46278),M=n(89385),z=n(83228);const V=(0,C.T5)();function A(e){return e.pipe((0,w.g)(E.h8.type),(0,o.M)((e=>{const{params:t}=e;if(!t)return;const n=Object.keys(t),o=new URLSearchParams(window.location.search),i=[];o.forEach(((e,t)=>{t.startsWith("gd")&&i.push(t)})),i.forEach((e=>{o.delete(e)})),n.forEach((e=>{o.set(`gd${e}`,t[e])})),window.history.replaceState({},document.title,`${window.location.pathname}?${o.toString()}`)})),(0,i.w)())}function N(e,t){return e.pipe((0,w.g)(E.iG.type),(0,r.n)((e=>{const n=(0,S.Vv)(t.value);return n?((0,b.F)({category:"pubHost",action:"initialized",data:e}),delete e.source,(0,l.of)((0,E.iw)({gameId:n.id,data:e}))):a.w})))}function H(e,t){return e.pipe((0,w.g)(E.Co.type),(0,o.M)((e=>{var n;const o=(0,S.Vv)(t.value);null!=o&&o.id&&(0,b.F)({category:"account",action:"gamesaveError",data:{gameID:o.id,method:"cloudsavegameScript",context:"cloudsavegame script error",error:null===(n=e.data)||void 0===n?void 0:n.error}})})),(0,i.w)())}function $(e,t){var n,o;null===(n=window.frames)||void 0===n||null===(n=n.gameFrame)||void 0===n||null===(o=n.postMessage)||void 0===o||o.call(n,{type:"fetchedSaveGame",resolution:e,data:t},"*")}function K(e,t){return e.pipe((0,w.g)(E.on.type),(0,c.p)((()=>["game","preview","mystery"].includes((0,S.K5)(t.value)))),(0,o.M)((async()=>{const e=(0,S.Vv)(t.value),n=(0,M.Fh)(t.value);if(null!=e&&e.id)try{let i,r=0;const a=localStorage.getItem(`playtime-${e.id}`)||0;let l="cloud",c=!1;if(n.includes(e.id))l="local";else{try{var o;if((0,M.Ep)(t.value))i=await(0,z.$)(e.id),r=(null===(o=i)||void 0===o?void 0:o.playtime)||0,c=!(0,z.jJ)(i);console.log("[SaveGame] fetched gamesave from user-vault",i)}catch(t){console.error(t),(0,b.F)({category:"account",action:"gamesaveError",data:{gameID:e.id,method:"fetchSaveGameEpic",context:"fetching gamesave from cloud",error:t instanceof Error?t.message:String(t)}})}c||(l="local"),"cloud"===l&&localStorage.setItem(`playtime-${e.id}`,r.toString())}console.log("[SaveGame] Sending postMessage with data and resolution",i,l),(0,b.F)({category:"account",action:"fetchSaveGame",data:{resolution:l,localPlaytime:a,cloudPlaytime:r,receivedPopulatedSaveGameFromCloud:c}}),$(l,i)}catch(t){console.error(t),(0,b.F)({category:"account",action:"gamesaveError",data:{gameID:e.id,method:"fetchSaveGameEpic",context:"sending postMessage to gameFrame",error:t instanceof Error?t.message:String(t)}})}else $("local",{playtime:0,ls:"",idb:""})})),(0,i.w)())}const X=()=>document.getElementById("game-container"),U=()=>document.getElementById("game-element"),W=()=>{U()&&(0,L.e)()};function Q(e,t){if(!(0,h.H6)(t.value)||"undefined"==typeof window)return a.w;const n=(0,d.R)(window,"resize").pipe((0,s.c)(500),(0,r.n)((()=>(W(),a.w))),(0,u.B)(3e3)),o=(0,d.R)(window,"orientationchange").pipe((0,r.n)((()=>(W(),a.w))),(0,u.B)(3e3));return e.pipe((0,w.g)(E.gO.type),(0,r.n)((({toggle:t})=>t?((0,D.r)(),W(),(0,p.h)(n,o).pipe((0,g.Q)(e.pipe((0,w.g)(E.gO.type),(0,c.p)((({toggle:e})=>!e)))))):a.w)))}const j=(e,t)=>{var n,o;if(!e)return;const i=(0,h.zS)(t),r=(0,h.W3)(t),a=(0,S.Vv)(t),l=(0,h.H6)(t),c=null===(n=window)||void 0===n||null===(n=n.screen)||void 0===n||null===(n=n.orientation)||void 0===n?void 0:n.lock,d=l&&c&&(null==a||null===(o=a.mobile_file)||void 0===o?void 0:o.orientation);if(!i&&!r)try{e.requestFullscreen({navigationUI:"hide"}).catch((()=>{}))}catch{}finally{e.focus()}var s;d&&(s=a.mobile_file.orientation,["portrait","landscape"].includes(s)&&window.screen.orientation.lock(s).catch((()=>{})))};function J(e,t){if("undefined"==typeof window)return a.w;const n=(0,_.Gd)(t.value);return e.pipe((0,w.g)(h.SG.type,k.y.type,h.Xy.type),(0,c.p)((()=>"game"===(0,S.K5)(t.value))),(0,r.n)((()=>e.pipe((0,w.g)(E.wZ.type),(0,c.p)((({event:e})=>e===I.Pz)),(0,f.s)(1),(0,v.T)((()=>{const e=(0,S.Vv)(t.value),{id:o}=e||{};if(!o)return a.w;if((0,M.Ep)(t.value))try{const e=`${V}/players/history`;fetch(e,{method:"POST",body:JSON.stringify({game_id:o}),credentials:"include"})}catch(e){}const i=[...(0,h.Fe)(t.value)],r=i.findIndex((e=>e.id===o)),l=r>-1?i.filter((e=>e.id!==o)):i,c={id:o,pt:r>-1?i[r].pt:0,lp:Date.now()};l.unshift(c);const d=l.slice(0,100);return(0,h.pX)({recentGames:d,siteID:n.id})}))))))}function Y(e,t){if("undefined"==typeof window)return a.w;const n=(0,_.Gd)(t.value),o=e.pipe((0,w.g)(k.y.type));return e.pipe((0,w.g)(h.pX.type),(0,r.n)((()=>(0,m.O)(6e4).pipe((0,v.T)((()=>{const{id:e}=(0,S.Vv)(t.value),o=(0,h.Fe)(t.value),i=o.find((t=>t.id===e));if(i){const t=parseInt(i.pt||0,10)+60,r=o.map((n=>n.id===e?{...n,pt:t}:n));return(0,h.pX)({recentGames:r,siteID:n.id})}return a.w})),(0,g.Q)(o)))))}function Z(e,t){const n=(0,d.R)(window,"fullscreenchange").pipe((0,r.n)((()=>{var e,n,o;return W(),(0,E.QX)(t.value)!==!(null===(e=document)||void 0===e||!e.fullscreenElement)&&(!(0,h.H6)(t.value)||null!==(n=document)&&void 0!==n&&n.fullscreenElement)?(0,l.of)((0,E.gO)({toggle:!(null===(o=document)||void 0===o||!o.fullscreenElement)})):a.w}))),s=e.pipe((0,w.g)(E.lh.type),(0,c.p)((({toggle:e})=>e)),(0,o.M)((()=>{j(document.body,t.value)})),(0,v.T)((()=>(0,E.gO)({toggle:!0})))),u=()=>{var e,n;if(!(0,E.QX)(t.value))return a.w;null===(e=window)||void 0===e||null===(e=e.PokiSDK)||void 0===e||null===(n=e.stopVideoAd)||void 0===n||n.call(e),(0,x.Jb)();try{var o,i;null===(o=document)||void 0===o||null===(i=o.exitFullscreen)||void 0===i||i.call(o).catch((()=>{}))}catch{}return window.removeEventListener("resize",W),window.removeEventListener("orientationchange",W),(0,l.of)((0,E.gO)({toggle:!1}))},f=e.pipe((0,w.g)(E.lh.type),(0,c.p)((({toggle:e})=>!e)),(0,r.n)((()=>u()))),m=e.pipe((0,w.g)("@@router/LOCATION_CHANGE"),(0,c.p)((()=>!window.location.toString().includes("#fullscreen")&&!window.location.toString().includes("#goog_rewarded"))),(0,r.n)((()=>u()))),y=e.pipe((0,w.g)(E.Br.type),(0,c.p)((()=>(0,h.H6)(t.value))),(0,r.n)((()=>(0,p.h)((0,d.R)(X(),"click"),(0,d.R)(U(),"click")).pipe((0,c.p)((()=>(0,h.H6)(t.value))),(0,o.M)((()=>{j(document.body,t.value),(0,x.IF)()})),(0,g.Q)(f),(0,i.w)())))),b=e.pipe((0,w.g)(E.gO.type),(0,r.n)((({payload:e})=>{const{toggle:t}=e,{body:n}=document,o=document.getElementById("app-root");return o.style.overflow=t?"hidden":"auto",o.style.height=t?"100svh":"auto",t?n.classList.add("isFullscreen"):n.classList.remove("isFullscreen"),a.w})));return(0,p.h)(s,f,m,n,y,b)}function q(e){return e.pipe((0,w.g)(E.wZ.type),(0,c.p)((({event:e})=>e===I.NS)),(0,v.T)((()=>(0,E.x9)())))}function ee(e,t){return e.pipe((0,w.g)(E.kK.type),(0,y.c)(3e3),(0,c.p)((()=>{var e;return null===(e=window)||void 0===e||null===(e=e.frames)||void 0===e?void 0:e.gameFrame})),(0,o.M)((({callback:e})=>{var n;const o="screenshot"===e,i=(0,S.Vv)(t.value);window.frames.gameFrame.postMessage({type:"pokiGenerateScreenshot",hasFrame:o,title:i.title,thumbnail:null===(n=i.image)||void 0===n?void 0:n.path,callback:e},"*")})))}function te(e,t){return e.pipe((0,w.g)(O.X$.type),(0,y.c)(1e4),(0,r.n)((({screenshot:e,errors:n})=>{var o;const r=(0,O.p3)(t.value),a=(0,G.A)("tracking"),l=(0,F.p)(t.value),c=(0,E.yd)(t.value),d=(0,_.Gd)(t.value),s=(0,S.Vv)(t.value),u=(0,P.nj)(t.value),p=(0,E.zM)(t.value),g=(0,E.pT)(t.value),f=(0,R.v)(t.value),v=(null==c?void 0:c.gameID)===s.pokifordevs_game_id?c.gameVersion:void 0,m=(null==f||null===(o=f.page)||void 0===o?void 0:o.start)>0?Date.now()-f.page.start:0,y=document.getElementById("game-element");let w,h;y&&(w=`${y.clientWidth}x${y.clientHeight}`);try{const e=document.createElement("canvas"),t={powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1};let n=e.getContext("webgl2",t);if(n||(n=e.getContext("webgl",t),n||(n=e.getContext("experimental-webgl",t))),n){const e=n.getExtension("WEBGL_debug_renderer_info");e&&(h=n.getParameter(e.UNMASKED_RENDERER_WEBGL)),h||(h=n.getParameter(n.RENDERER))}}catch{}return a("/playground-feedback",{method:"POST",body:JSON.stringify({p4d_game_id:s.pokifordevs_game_id,p4d_version_id:v,type:"bugreport",site_id:d.id,message:r,screenshot:e,experiment:l,adblock:u,was_fullscreen:p,game_resolution:w,loading_finished:g,time_on_page:m,errors:n,webgl_renderer:h,device_pixel_ratio:window.devicePixelRatio||1})}).pipe((0,i.w)())})))}function ne(e,t){return e.pipe((0,w.g)(E.u9.type),(0,v.T)((e=>null==e?void 0:e.data)),(0,r.n)((({screenshot:e,errors:n,callback:o})=>{if("bugReport"===o)try{return(0,l.of)((0,O.X$)({screenshot:e,errors:n}))}catch{return a.w}if("ratings"===o)try{const o=(0,T.xI)(t.value);return(0,l.of)((0,B.rY)({voteDirection:o.voteDirection,message:o.message,screenshot:e,errors:n}))}catch{return a.w}})))}function oe(e,t){return e.pipe((0,w.g)(h.Xy.type),(0,c.p)((()=>"preview"===(0,S.K5)(t.value))),(0,s.c)(1e4),(0,o.M)((()=>{console.info("%c🛡️ Content Security Policy (CSP) Notice 🛡️\n\n%cThis website has a strict Content Security Policy.\nIf your game needs to access external resources, please contact us.\n\n%c📧 Email your exact domains, including ports and protocol, to: developers@poki.com\n🔗 Don't forget to include a link to your game!\n\n%cThank you for your cooperation in maintaining our security standards!","font-size: 20px; font-weight: bold; color: #4a90e2;","font-size: 14px; color: #666;","font-size: 14px; color: #0a84ff; font-weight: bold;","font-size: 14px; color: #666; font-style: italic;")})),(0,i.w)())}}}]);
//# sourceMappingURL=client~4040~7e2fa4a4f099b11fbf1b.js.map